# Local run instructions — Maharashtra Crop System

This file explains how to prepare a development environment, run the Streamlit app locally, and safely prepare the repo for GitHub.

## Summary (quick)
- Create a Python venv, install dependencies, and start Streamlit.
- The repo includes large model files; by default they are ignored by `.gitignore`.
- Do NOT commit secrets (`serviceAccountKey.json`, `.env`) — keep them out of Git.

## Create and activate the virtual environment (Windows PowerShell)
```powershell
Set-Location -Path 'E:\GC Update'
python -m venv .venv
.\.venv\Scripts\Activate.ps1
.
# Upgrade pip and install requirements
python -m pip install --upgrade pip
python -m pip install -r requirements.txt
```

If you have a prepared venv in `archive/` you can move it back or recreate with `scripts/setup_env.ps1`.

## Quick start (recommended helper)
We provided helper scripts in `scripts/`:
- `scripts/setup_env.ps1` — creates/updates `.venv` and installs `requirements.txt`.
- `scripts/run_streamlit.ps1` — ensures Streamlit is installed in the venv and starts the app.

Example:
```powershell
Set-Location -Path 'E:\GC Update'
.\scripts\setup_env.ps1
.\scripts\run_streamlit.ps1 -Port 8501
```

## Generating PDF reports
- Use the app UI to run analyses and click the "Download PDF Report" button.
- The generated PDF is multi-page and includes cover, summary, optional image, soil nutrients, NDVI trend, and recommendations.

## Large dataset handling

The repository previously contained `agriculture_dataset.csv`, which is large and not suitable for storing in GitHub. That file has been moved to `archive/` to keep the repository small.

To download the dataset from Google Drive at runtime, use the provided downloader script:

```powershell
Set-Location -Path 'E:\GC Update'
.\.venv\Scripts\python.exe tools\download_dataset.py --url "https://drive.google.com/file/d/12KSkHFI7Ri97nkBUdJfdztIZvBVsGCuJ/view?usp=drive_link" --dest dataset/agriculture_dataset.csv
```

This will stream-download the dataset into `dataset/agriculture_dataset.csv`.

If you prefer to keep a local copy outside the repo, download it manually and place it into `dataset/` or another data folder and update any code that references `agriculture_dataset.csv` to point to the new path.

### Avoid re-downloading repeatedly

To avoid repeated downloads, use the `ensure_dataset` helper which will first check for a copy inside `archive/` and copy it if present; only if not found will it download from Google Drive.

```powershell
Set-Location -Path 'E:\GC Update'
.\.venv\Scripts\python.exe tools\ensure_dataset.py --dest dataset/agriculture_dataset.csv --url "https://drive.google.com/file/d/12KSkHFI7Ri97nkBUdJfdztIZvBVsGCuJ/view?usp=drive_link"
```

This command:
- copies `archive/agriculture_dataset.csv` to `dataset/agriculture_dataset.csv` if the archive copy exists (fast), or
- downloads from Google Drive if the archive copy is not present.

You only need to run this once per machine; subsequent runs of the app will use the local copy at `dataset/agriculture_dataset.csv`.

## Preparing for GitHub
1. `.gitignore` now excludes virtualenvs, logs, backups, and model files (`*.h5`, `saved_model/`) by default.
   - Large model files should be stored in external storage (S3/GCS) or tracked with Git LFS if you must keep them in the repo.
2. Do not commit `serviceAccountKey.json` or `.env`.
3. If sensitive files have already been committed, use a history-rewrite tool (BFG or `git filter-repo`) to remove them from history before pushing. Contact me if you want help with that — it is destructive and requires coordination.

## Archival
- Large or redundant items were moved to `archive/` at the project root. This is reversible; move the files back to restore them.

## Troubleshooting
- If Streamlit fails to import because TensorFlow is missing, install TF in the venv:
```powershell
.\.venv\Scripts\python.exe -m pip install tensorflow
```
- If you run into permission issues activating the venv on Windows, run PowerShell as Administrator and set the execution policy (temporary):
```powershell
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
.\.venv\Scripts\Activate.ps1
```

## Next steps before publishing to GitHub
- Verify `.gitignore` is correct for your choices regarding models.
- If you want to publish models, use Git LFS or remove them from `.gitignore` and store them in a release asset or external storage.
- Optionally run: `tools\validate_requirements.py` (with venv python) to verify installed packages.

---
Generated by the maintenance scripts in this workspace. If you want, I can also create a `README.md` snippet for the GitHub repository homepage.
